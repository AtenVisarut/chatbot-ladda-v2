"""
Text Message Templates
‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Chatbot Ladda - Plant Disease Detection
‡πÉ‡∏ä‡πâ‡πÅ‡∏ó‡∏ô Flex Messages ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î - return string ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
"""

from typing import Dict, List, Optional

from app.prompts import WELCOME_MESSAGE


# =============================================================================
# Welcome & Registration Messages
# =============================================================================

def get_welcome_text() -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö user ‡πÉ‡∏´‡∏°‡πà"""
    return WELCOME_MESSAGE








# =============================================================================
# Help & Guide Messages
# =============================================================================

def get_help_menu_text() -> str:
    """‡πÄ‡∏°‡∏ô‡∏π‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠"""
    return (
        "üìã ‡πÄ‡∏°‡∏ô‡∏π‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠\n"
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        "‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:\n"
        "1. ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏£‡∏Ñ\n"
        "2. ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏°‡∏≤‡∏ó‡∏≤‡∏á‡πÅ‡∏ä‡∏ó\n"
        "3. ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏™‡∏±‡πâ‡∏ô‡πÜ (‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä, ‡∏£‡∏∞‡∏¢‡∏∞)\n"
        "4. ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏¢‡∏≤‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥\n\n"
        "‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ:\n"
        "- ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á\n"
        "- ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡∏ä‡∏±‡∏î‡πÜ\n"
        "- ‡πÄ‡∏ô‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£\n\n"
        "‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏≠‡∏∑‡πà‡∏ô‡πÜ:\n"
        "- ‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏î‡∏π‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤\n"
        "- ‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠\n"
        "- ‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà\n\n"
        "üí¨ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞"
    )


def get_usage_guide_text() -> str:
    """‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"""
    return (
        "üìñ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ICP Ladda Chatbot\n"
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        "üì∑ ‡∏ï‡∏£‡∏ß‡∏à‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä:\n"
        "- ‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏°‡∏≤‡∏ó‡∏≤‡∏á‡πÅ‡∏ä‡∏ó\n"
        "- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï\n"
        "- ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå\n\n"
        "üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ:\n"
        "- ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á\n"
        "- ‡∏ñ‡πà‡∏≤‡∏¢‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡∏ä‡∏±‡∏î‡πÜ\n"
        "- ‡πÄ‡∏ô‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£\n\n"
        "üí¨ ‡∏ñ‡∏≤‡∏°‡∏ï‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä:\n"
        "- ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢\n"
        "- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡πÉ‡∏´‡πâ\n\n"
        "üìö ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà:\n"
        "https://www.icpladda.com/about/"
    )


def get_product_catalog_text() -> str:
    """‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå"""
    return (
        "üì¶ ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå ICP Ladda\n"
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        "‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå:\n"
        "üêõ ‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÅ‡∏°‡∏•‡∏á\n"
        "üçÑ ‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤\n"
        "üåø ‡∏¢‡∏≤‡∏Ü‡πà‡∏≤‡∏´‡∏ç‡πâ‡∏≤\n"
        "üíß ‡∏õ‡∏∏‡πã‡∏¢‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°\n\n"
        "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:\n"
        "üîó https://www.icpladda.com/about/\n\n"
        "üí¨ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ñ‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞"
    )


# =============================================================================
# Disease Detection Flow Messages
# =============================================================================

def get_initial_questions_text() -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏≤‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä (Step 1/2)"""
    return (
        "üå± ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 1/2: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä\n"
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:\n\n"
        "- ‡∏Ç‡πâ‡∏≤‡∏ß\n"
        "- ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô\n"
        "- ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î\n"
        "- ‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á\n"
        "- ‡∏≠‡πâ‡∏≠‡∏¢\n"
        "- ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä)\n\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    )


def get_other_plant_prompt_text() -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä‡∏≠‡∏∑‡πà‡∏ô"""
    return (
        "üåø ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡πà‡∏∞\n\n"
        "‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á, ‡∏•‡∏≥‡πÑ‡∏¢, ‡∏™‡πâ‡∏°, ‡∏û‡∏£‡∏¥‡∏Å, ‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®, ‡∏¢‡∏≤‡∏á‡∏û‡∏≤‡∏£‡∏≤, ‡∏õ‡∏≤‡∏•‡πå‡∏°\n\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    )


def get_plant_type_retry_text() -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"""
    return (
        "‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏\n\n"
        "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡πÉ‡∏´‡∏°‡πà:\n"
        "- ‡∏Ç‡πâ‡∏≤‡∏ß\n"
        "- ‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô\n"
        "- ‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î\n"
        "- ‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á\n"
        "- ‡∏≠‡πâ‡∏≠‡∏¢\n"
        "- ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏∑‡∏ä)\n\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    )


def get_growth_stage_question_text(plant_type: str) -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï (Step 2/2) ‡∏ï‡∏≤‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä"""
    stages = _get_growth_stages_for_plant(plant_type)
    stages_text = "\n".join(f"- {s}" for s in stages)

    return (
        f"üå± ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ó‡∏µ‡πà 2/2: ‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏≠‡∏á{plant_type}\n"
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        f"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï:\n\n"
        f"{stages_text}\n\n"
        "‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå \"‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö\" ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    )


def _get_growth_stages_for_plant(plant_type: str) -> list:
    """‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏ï‡∏≤‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä"""
    plant_lower = plant_type.lower() if plant_type else ""

    if "‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î" in plant_lower:
        return ["‡∏á‡∏≠‡∏Å/‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏ï‡∏¥‡∏î‡∏ù‡∏±‡∏Å"]
    elif "‡∏Ç‡πâ‡∏≤‡∏ß" in plant_lower:
        return ["‡∏Å‡∏•‡πâ‡∏≤/‡∏õ‡∏±‡∏Å‡∏î‡∏≥", "‡πÅ‡∏ï‡∏Å‡∏Å‡∏≠", "‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πâ‡∏≠‡∏á", "‡∏≠‡∏≠‡∏Å‡∏£‡∏ß‡∏á"]
    elif "‡∏°‡∏±‡∏ô‡∏™‡∏≥‡∏õ‡∏∞‡∏´‡∏•‡∏±‡∏á" in plant_lower or "‡∏°‡∏±‡∏ô" in plant_lower:
        return ["‡∏õ‡∏•‡∏π‡∏Å‡πÉ‡∏´‡∏°‡πà", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï", "‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏õ‡πâ‡∏á", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏≠‡πâ‡∏≠‡∏¢" in plant_lower:
        return ["‡∏á‡∏≠‡∏Å/‡πÅ‡∏ï‡∏Å‡∏Å‡∏≠", "‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡πâ‡∏≠‡∏á", "‡∏™‡∏∞‡∏™‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏ó‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" in plant_lower:
        return ["‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏ï‡∏¥‡∏î‡∏ú‡∏•", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏°‡∏∞‡∏°‡πà‡∏ß‡∏á" in plant_lower:
        return ["‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏ï‡∏¥‡∏î‡∏ú‡∏•", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏•‡∏≥‡πÑ‡∏¢" in plant_lower:
        return ["‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏ï‡∏¥‡∏î‡∏ú‡∏•", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏™‡πâ‡∏°" in plant_lower or "‡∏°‡∏∞‡∏ô‡∏≤‡∏ß" in plant_lower:
        return ["‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡∏ï‡∏¥‡∏î‡∏ú‡∏•", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏¢‡∏≤‡∏á‡∏û‡∏≤‡∏£‡∏≤" in plant_lower or "‡∏¢‡∏≤‡∏á" in plant_lower:
        return ["‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏£‡∏µ‡∏î", "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏£‡∏µ‡∏î", "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ï‡πâ‡∏ô"]
    elif "‡∏õ‡∏≤‡∏•‡πå‡∏°" in plant_lower:
        return ["‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡∏ó‡∏•‡∏≤‡∏¢", "‡∏≠‡∏≠‡∏Å‡∏ó‡∏•‡∏≤‡∏¢", "‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏ï‡πâ‡∏ô"]
    elif "‡∏û‡∏£‡∏¥‡∏Å" in plant_lower:
        return ["‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif "‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®" in plant_lower:
        return ["‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    elif any(v in plant_lower for v in ["‡∏ú‡∏±‡∏Å", "‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠", "‡πÅ‡∏ï‡∏á", "‡∏Å‡∏∞‡∏´‡∏•‡πà‡∏≥", "‡∏Ñ‡∏∞‡∏ô‡πâ‡∏≤", "‡∏ú‡∏±‡∏Å‡∏Å‡∏≤‡∏î"]):
        return ["‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï", "‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]
    else:
        return ["‡∏ï‡πâ‡∏ô‡∏≠‡πà‡∏≠‡∏ô", "‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï", "‡∏≠‡∏≠‡∏Å‡∏î‡∏≠‡∏Å/‡∏ú‡∏•", "‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß"]


def get_analyzing_text(with_info: bool = False) -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå"""
    if with_info:
        return "üî¨ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏Ñ‡πà‡∏∞"
    return "üî¨ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏Ñ‡πà‡∏∞"


# =============================================================================
# Disease Result & Product Messages
# =============================================================================

def format_disease_result_text(
    disease_name: str,
    confidence: str,
    symptoms: str,
    severity: str,
    raw_analysis: str = "",
    pest_type: str = "",
    pest_vector: str = None,
    category: str = "",
    show_product_hint: bool = True
) -> str:
    """Format ‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä‡πÄ‡∏õ‡πá‡∏ô text"""
    # Severity label
    severity_label = _get_severity_label(severity)

    lines = [
        "üîç ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÇ‡∏£‡∏Ñ‡∏û‡∏∑‡∏ä",
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
        "",
        f"ü¶† ‡πÇ‡∏£‡∏Ñ: {disease_name}",
        f"‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á: {severity_label}",
    ]

    if category:
        lines.append(f"üìã ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: {category}")

    if pest_type:
        lines.append(f"üè∑Ô∏è ‡∏ä‡∏ô‡∏¥‡∏î: {pest_type}")

    lines.append("")

    # Symptoms
    if symptoms:
        formatted_symptoms = _format_symptoms_text(symptoms)
        lines.append(f"üåø ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£: {formatted_symptoms}")
        lines.append("")

    # Pest vector warning
    if pest_vector:
        lines.append(f"üêõ ‡πÅ‡∏°‡∏•‡∏á‡∏û‡∏≤‡∏´‡∏∞: {pest_vector}")
        lines.append("‚ö†Ô∏è ‡∏Ñ‡∏ß‡∏£‡∏Å‡∏≥‡∏à‡∏±‡∏î‡πÅ‡∏°‡∏•‡∏á‡∏û‡∏≤‡∏´‡∏∞‡∏£‡πà‡∏ß‡∏°‡∏î‡πâ‡∏ß‡∏¢")
        lines.append("")

    # Recommendations from raw_analysis
    if raw_analysis:
        recommendation = _format_recommendation_text(raw_analysis)
        if recommendation:
            lines.append(f"üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: {recommendation}")
            lines.append("")

    if show_product_hint:
        lines.append("üíä ‡∏î‡∏π‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á")

    lines.append("")
    lines.append("‚ö†Ô∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ")

    return "\n".join(lines)


def format_product_list_text(products: List[Dict]) -> str:
    """Format ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏õ‡πá‡∏ô text"""
    if not products:
        return "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°"

    lines = [
        "üíä ‡∏ú‡∏•‡∏¥‡∏ï‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥",
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
    ]

    for idx, p in enumerate(products[:5], 1):
        name = p.get("product_name", "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏")
        active = p.get("active_ingredient", "-")
        target = p.get("target_pest", "-")
        crops = p.get("applicable_crops", "-")
        period = p.get("usage_period", "-")
        how = p.get("how_to_use", "-")
        rate = p.get("usage_rate", "-")
        link = p.get("link_product", "")

        lines.append("")
        lines.append(f"{'‚îÄ'*20}")
        lines.append(f"{idx}. {name}")
        lines.append(f"   ‡∏™‡∏≤‡∏£‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: {active}")
        lines.append(f"   ‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏û‡∏∑‡∏ä: {target}")
        lines.append(f"   ‡∏û‡∏∑‡∏ä‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ: {crops}")
        lines.append(f"   ‡∏ä‡πà‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ: {period}")
        lines.append(f"   ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: {how}")
        lines.append(f"   ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÉ‡∏ä‡πâ: {rate}")
        if link and link.startswith("http"):
            lines.append(f"   üîó {link}")

    lines.append("")
    lines.append("‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ")
    lines.append("üìö ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°: https://www.icpladda.com/about/")
    lines.append("‚ö†Ô∏è ‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏ï‡∏£‡∏≤/‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ï‡∏≤‡∏°‡∏â‡∏•‡∏≤‡∏Å‡∏à‡∏£‡∏¥‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á")

    return "\n".join(lines)


# =============================================================================
# Context Handler Messages
# =============================================================================

def get_continue_or_cancel_text(current_task: str) -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏ï‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"""
    return (
        f"‚ö†Ô∏è ‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà\n\n"
        f"‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á{current_task}‡∏≠‡∏¢‡∏π‡πà‡∏Ñ‡πà‡∏∞\n\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏ó‡∏≥‡∏ï‡πà‡∏≠\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ï‡πà‡∏≠\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å"
    )


def get_image_choice_text() -> str:
    """‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏≤‡∏°‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°"""
    return (
        "üì∑ ‡∏Ñ‡∏∏‡∏ì‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤\n\n"
        "‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤\n"
        "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏π‡∏õ‡πÑ‡∏´‡∏ô‡∏Ñ‡∏∞?\n\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏°‡πà\n"
        "‡∏û‡∏¥‡∏°‡∏û‡πå \"‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°\" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏î‡∏¥‡∏°"
    )


# =============================================================================
# Helper Functions
# =============================================================================

def _format_symptoms_text(symptoms: str) -> str:
    """Format ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö"""
    if not symptoms:
        return "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏£"
    symptoms = symptoms.strip()
    if len(symptoms) <= 200:
        return symptoms
    cut_point = 200
    for sep in ['. ', ' | ', ', ', ' ']:
        idx = symptoms.rfind(sep, 0, 250)
        if idx > 100:
            cut_point = idx + len(sep)
            break
    return symptoms[:cut_point].strip()


def _get_severity_label(severity: str) -> str:
    """‡πÅ‡∏õ‡∏•‡∏á severity ‡πÄ‡∏õ‡πá‡∏ô label"""
    if not severity:
        return "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á"
    severity_lower = severity.lower()
    if any(x in severity_lower for x in ['‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á', '‡∏™‡∏π‡∏á', '‡∏°‡∏≤‡∏Å', 'severe', 'high']):
        return "‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á"
    elif any(x in severity_lower for x in ['‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢', '‡∏ï‡πà‡∏≥', '‡∏ô‡πâ‡∏≠‡∏¢', 'mild', 'low', 'light']):
        return "‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢"
    return "‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á"


def _format_recommendation_text(raw_analysis: str) -> str:
    """Format ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å raw_analysis"""
    if not raw_analysis:
        return ""
    parts = raw_analysis.split(' | ')
    main_part = parts[0] if parts else raw_analysis
    result = main_part.strip()
    if len(result) > 300:
        cut_point = 300
        for sep in ['. ', '‡•§ ', ' - ']:
            idx = result.rfind(sep, 0, 350)
            if idx > 150:
                cut_point = idx + len(sep)
                break
        result = result[:cut_point].strip()
    return result
