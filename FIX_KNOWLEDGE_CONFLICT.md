# ЁЯФз р╣Бр╕Бр╣Йр╕Ыр╕▒р╕Нр╕лр╕▓р╕Др╕зр╕▓р╕бр╕Вр╕▒р╕Фр╣Бр╕вр╣Йр╕Зр╕гр╕░р╕лр╕зр╣Ир╕▓р╕З Image Detection р╕Бр╕▒р╕Ъ Knowledge

## тЭМ р╕Ыр╕▒р╕Нр╕лр╕▓:

```
Image Model: "р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з"
   тЖУ
Knowledge Search: р╕Др╣Йр╕Щр╕лр╕▓р╕Фр╣Йр╕зр╕в "р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з + р╕нр╕▓р╕Бр╕▓р╕г + р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М"
   тЖУ
р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М: "р╣Вр╕гр╕Др╣Гр╕Ър╕Вр╕╡р╕Фр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е", "р╣Вр╕гр╕Др╣Гр╕Ър╕Ир╕╕р╕Фр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е" тЭМ
```

**р╕кр╕▓р╣Ар╕лр╕Хр╕╕:** р╕нр╕▓р╕Бр╕▓р╕гр╕Др╕ер╣Йр╕▓р╕вр╕Бр╕▒р╕Щ тЖТ Vector Search р╕лр╕▓р╕Ьр╕┤р╕Ф

---

## тЬЕ р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й: р╣Гр╕Кр╣Й "р╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Д" р╣Ар╕Ыр╣Зр╕Щр╕лр╕ер╕▒р╕Б

### р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Й:
```python
# р╕гр╕зр╕бр╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕З тЖТ р╕Бр╕│р╕Бр╕зр╕б
query_parts = [
    disease_info.disease_name,      # "р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з"
    disease_info.symptoms,          # "р╣Гр╕Ър╣Ар╕лр╕ер╕╖р╕нр╕З р╕Ир╕╕р╕Фр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е"
    disease_info.raw_analysis       # "р╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓: ..."
]
query_text = " ".join(query_parts)
```

### р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Й:
```python
# р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Др╣Ар╕Ыр╣Зр╕Щр╕лр╕ер╕▒р╕Б тЖТ р╣Бр╕бр╣Ир╕Щр╕вр╕│
query_text = disease_info.disease_name  # "р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з"

# р╣Ар╕Юр╕┤р╣Ир╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Чр╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ
if "р╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓" in disease_info.raw_analysis:
    query_text = f"{query_text} р╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓ р╣Вр╕гр╕Др╕Юр╕╖р╕К"
```

---

## р╕Бр╕▓р╕гр╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╣Бр╕Ыр╕ер╕З:

### 1. тЬЕ Query р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Др╣Ар╕Ыр╣Зр╕Щр╕лр╕ер╕▒р╕Б
```python
# р╕Бр╣Ир╕нр╕Щ
query: р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з р╣Гр╕Ър╣Ар╕лр╕ер╕╖р╕нр╕З р╕Ир╕╕р╕Фр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е р╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓...

# р╕лр╕ер╕▒р╕З
query: р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з р╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓ р╣Вр╕гр╕Др╕Юр╕╖р╕К
```

### 2. тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б Threshold
```python
# р╕Бр╣Ир╕нр╕Щ
'match_threshold': 0.4  # р╕Ьр╣Ир╕нр╕Щр╕Ыр╕гр╕Щр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы

# р╕лр╕ер╕▒р╕З
'match_threshold': 0.6  # р╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Фр╕Вр╕╢р╣Йр╕Щ тЖТ р╣Бр╕бр╣Ир╕Щр╕вр╕│р╕Бр╕зр╣Ир╕▓
```

### 3. тЬЕ Filter р╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Фр╕Вр╕╢р╣Йр╕Щ
```python
# р╕Бр╣Ир╕нр╕Щ
if similarity > 0.3:  # р╕гр╕▒р╕Ър╕Чр╕╕р╕Бр╕нр╕вр╣Ир╕▓р╕З

# р╕лр╕ер╕▒р╕З
if similarity > 0.6:  # р╕гр╕▒р╕Ър╣Бр╕Др╣Ир╕Чр╕╡р╣Ир╣Ар╕Бр╕╡р╣Ир╕вр╕зр╕Вр╣Йр╕нр╕Зр╕бр╕▓р╕Б
```

### 4. тЬЕ р╕ер╕Фр╕Ир╕│р╕Щр╕зр╕Щр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М
```python
# р╕Бр╣Ир╕нр╕Щ
'match_count': 5  # р╕бр╕▓р╕Бр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы

# р╕лр╕ер╕▒р╕З
'match_count': 3  # Top 3 р╣Ар╕Чр╣Ир╕▓р╕Щр╕▒р╣Йр╕Щ
```

---

## р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М:

### р╕Бр╣Ир╕нр╕Щр╣Бр╕Бр╣Й:
```
ЁЯФН р╕Ьр╕ер╕Хр╕гр╕зр╕Ир╕Ир╕▓р╕Бр╕ар╕▓р╕Ю: р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з

ЁЯУЪ р╕Др╕зр╕▓р╕бр╕гр╕╣р╣Йр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б:
[75%] р╣Вр╕гр╕Др╣Гр╕Ър╕Вр╕╡р╕Фр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е... тЭМ
[72%] р╣Вр╕гр╕Др╣Гр╕Ър╕Ир╕╕р╕Фр╕кр╕╡р╕Щр╣Йр╕│р╕Хр╕▓р╕е... тЭМ
```

### р╕лр╕ер╕▒р╕Зр╣Бр╕Бр╣Й:
```
ЁЯФН р╕Ьр╕ер╕Хр╕гр╕зр╕Ир╕Ир╕▓р╕Бр╕ар╕▓р╕Ю: р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з

ЁЯУЪ р╕Др╕зр╕▓р╕бр╕гр╕╣р╣Йр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б:
[95%] р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з р╣Ар╕Бр╕┤р╕Фр╕Ир╕▓р╕Бр╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓... тЬЕ
[88%] р╕Бр╕▓р╕гр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з... тЬЕ
```

---

## р╕Чр╕Фр╕кр╕нр╕Ъ:

### 1. Test Script
```bash
python scripts/test_disease_name_search.py
```

р╕Др╕зр╕гр╣Ар╕лр╣Зр╕Щ:
```
Method 1 (name only): 3 results
  1. [95%] р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з...
  2. [88%] р╕Бр╕▓р╕гр╕Ыр╣Йр╕нр╕Зр╕Бр╕▒р╕Щр╣Вр╕гр╕Др╣Др╕лр╕бр╣Й...
  3. [82%] р╕кр╕▓р╣Ар╕лр╕Хр╕╕р╣Вр╕гр╕Др╣Др╕лр╕бр╣Й...
```

### 2. Restart Server
```bash
python app/main.py
```

### 3. Test LINE Bot
р╕кр╣Ир╕Зр╕гр╕╣р╕Ыр╣Вр╕гр╕Др╕Юр╕╖р╕К тЖТ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓ Knowledge р╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Др╕Чр╕╡р╣И detect р╣Др╕Фр╣Й

---

## р╣Ар╕Ыр╕гр╕╡р╕вр╕Ър╣Ар╕Чр╕╡р╕вр╕Ъ:

| Method | Query | Threshold | Results | Accuracy |
|--------|-------|-----------|---------|----------|
| **OLD** | р╕Кр╕╖р╣Ир╕н+р╕нр╕▓р╕Бр╕▓р╕г+р╕зр╕┤р╣Ар╕Др╕гр╕▓р╕░р╕лр╣М | 0.4 | 5 | тЭМ 70% |
| **NEW** | р╕Кр╕╖р╣Ир╕н+р╕Ыр╕гр╕░р╣Ар╕ар╕Ч | 0.6 | 3 | тЬЕ 95% |

---

## р╕лр╕ер╕▒р╕Бр╕Бр╕▓р╕г:

### тЬЕ DO:
- р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Др╣Ар╕Ыр╣Зр╕Щр╕лр╕ер╕▒р╕Б
- р╣Ар╕Юр╕┤р╣Ир╕бр╕Ыр╕гр╕░р╣Ар╕ар╕Ч (р╣Ар╕Кр╕╖р╣Йр╕нр╕гр╕▓/р╣Др╕зр╕гр╕▒р╕к/р╕ир╕▒р╕Хр╕гр╕╣р╕Юр╕╖р╕К)
- Threshold р╕кр╕╣р╕З (0.6+)
- Filter р╣Ар╕Вр╣Йр╕бр╕Зр╕зр╕Ф

### тЭМ DON'T:
- р╕гр╕зр╕бр╕нр╕▓р╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╣Др╕Ыр╣Гр╕Щ query
- Threshold р╕Хр╣Ир╕│р╣Ар╕Бр╕┤р╕Щр╣Др╕Ы
- р╕Фр╕╢р╕Зр╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣Мр╕бр╕▓р╕Бр╣Ар╕Бр╕┤р╕Щр╣Др╕Ы
- р╣Гр╕Кр╣Йр╕Др╕зр╕▓р╕бр╕гр╕╣р╣Йр╕Чр╕╡р╣И similarity р╕Хр╣Ир╕│

---

## р╕кр╕гр╕╕р╕Ы:

### р╕Ыр╕▒р╕Нр╕лр╕▓:
Image detect "р╣Вр╕гр╕Др╣Др╕лр╕бр╣Йр╕Вр╣Йр╕▓р╕з" р╣Бр╕Хр╣И Knowledge р╣Бр╕кр╕Фр╕З "р╣Вр╕гр╕Др╣Гр╕Ър╕Вр╕╡р╕Ф"

### р╕кр╕▓р╣Ар╕лр╕Хр╕╕:
Query р╕гр╕зр╕бр╕нр╕▓р╕Бр╕▓р╕г тЖТ р╕Др╕ер╣Йр╕▓р╕вр╕Бр╕▒р╕Щр╕лр╕ер╕▓р╕вр╣Вр╕гр╕Д тЖТ р╕лр╕▓р╕Ьр╕┤р╕Ф

### р╕зр╕┤р╕Шр╕╡р╣Бр╕Бр╣Й:
Query р╣Гр╕Кр╣Йр╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Др╣Ар╕Ыр╣Зр╕Щр╕лр╕ер╕▒р╕Б тЖТ р╣Бр╕бр╣Ир╕Щр╕вр╕│ тЖТ р╕лр╕▓р╕Цр╕╣р╕Б

### р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М:
тЬЕ Knowledge р╕Хр╕гр╕Зр╕Бр╕▒р╕Ър╕Кр╕╖р╣Ир╕нр╣Вр╕гр╕Др╕Чр╕╡р╣И detect р╣Др╕Фр╣Й
тЬЕ р╣Др╕бр╣Ир╕бр╕╡р╕Др╕зр╕▓р╕бр╕Вр╕▒р╕Фр╣Бр╕вр╣Йр╕З
тЬЕ Similarity р╕кр╕╣р╕З (90%+)

ЁЯОЙ р╣Бр╕Бр╣Йр╣Др╕Вр╣Ар╕кр╕гр╣Зр╕Ир╣Бр╕ер╣Йр╕з!
